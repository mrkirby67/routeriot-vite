<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getFirestore, doc, onSnapshot } 
    from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  // âœ… Pull config safely from your existing module
  import { firebaseConfig } from '/core/config.js';

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const gameOutput = document.getElementById("gameOutput");
  const gameStatus = document.getElementById("gameStatus");
  const teamOutput = document.getElementById("teamOutput");
  const teamStatus = document.getElementById("teamStatus");
  const teamInput = document.getElementById("teamNameInput");
  const watchBtn = document.getElementById("watchTeam");

  // ğŸ® Listen to GAMESTATE
  const gameRef = doc(db, "game", "gameState");
  onSnapshot(gameRef, (snap) => {
    if (!snap.exists()) {
      gameOutput.textContent = "âŒ No document found at game/gameState";
      return;
    }
    const data = snap.data();
    gameOutput.textContent = JSON.stringify(data, null, 2);
    const st = data.status || "unknown";
    gameStatus.textContent = `Status: ${st.toUpperCase()} â€¢ Updated: ${new Date().toLocaleTimeString()}`;
    console.log("ğŸ® gameState snapshot:", data);
  });

  // ğŸ Listen to TEAMSTATUS (on demand)
  let unsubscribeTeam = null;
  watchBtn.onclick = () => {
    const teamName = teamInput.value.trim();
    if (!teamName) return alert("Enter your team name first!");
    if (unsubscribeTeam) unsubscribeTeam();

    const ref = doc(db, "teamStatus", teamName);
    teamOutput.textContent = "Connecting to Firestoreâ€¦";

    unsubscribeTeam = onSnapshot(ref, (snap) => {
      if (!snap.exists()) {
        teamOutput.textContent = "âŒ No document found for team: " + teamName;
        return;
      }
      const data = snap.data();
      teamOutput.textContent = JSON.stringify(data, null, 2);
      teamStatus.textContent = `Updated: ${new Date().toLocaleTimeString()}`;
      console.log("ğŸ teamStatus snapshot:", data);
    });
  };
</script>