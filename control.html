<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Route Riot ‚Äì Control</title>
  <link rel="stylesheet" href="/style.css" />

  <!-- Favicons -->
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/site.webmanifest" />
  <script type="module" src="/core/runtime-config.js"></script>
</head>

<body>
  <div class="container">
    <!-- üéÆ Core Game Controls -->
    <div id="game-controls-container"></div>

    <!-- üßÆ Scoreboard -->
    <div id="scoreboard-container"></div>

    <!-- üîó Team Links -->
    <div id="team-links-container"></div>

    <!-- üèÅ Racer Management -->
    <div id="racer-management-container"></div>

    <!-- üó∫Ô∏è Zone Management -->
    <div id="zone-management-container"></div>

    <!-- üöß Speed Bump Control -->
    <div id="speedbump-container"></div>

    <!-- üöó Flat Tire Control -->
    <div id="flat-tire-control-container"></div>

    <!-- üéâ Surprise Selector -->
    <div id="surprise-selector-container"></div>

    <!-- ü™∞ Bug Strike Control -->
    <div id="bugstrike-control-container"></div>

    <!-- üì¢ Broadcasts -->
    <div id="broadcast-container"></div>

    <!-- üì® Control Chat (all teams) -->
    <div id="control-chat-container"></div>
  </div>

  <!-- üßæ Modal -->
  <div id="roster-modal" class="modal-backdrop" style="display: none;">
    <div class="modal-content">
      <span class="modal-close-btn">&times;</span>
      <h2>Team Rosters &amp; Links</h2>
      <p>Email the unique player URL to each team captain.</p>
      <div id="roster-modal-body"></div>
    </div>
  </div>

  <!-- üí° Control Orchestrator -->
  <script type="module" src="./control.js"></script>

  <!-- Inline fallback (for dev mode / isolated testing) -->
  <!--
  <script type="module">
    import {
      GameControlsComponent, initializeGameControlsLogic
    } from './components/GameControls/GameControls.js';
    import {
      BugStrikeControlComponent, initializeBugStrikeControl
    } from './components/BugStrikeControl/BugStrikeControl.js';
    import {
      SpeedBumpControlComponent, initializeSpeedBumpControl
    } from './components/SpeedBumpControl/SpeedBumpControl.js';
    import {
      SurpriseSelectorComponent, initializeSurpriseSelector
    } from './components/SurpriseSelector/SurpriseSelector.js';
    import {
      RacerManagementComponent, initializeRacerManagementLogic
    } from './components/RacerManagement/RacerManagement.js';
    import {
      ZoneManagementComponent, initializeZoneManagementLogic
    } from './components/ZoneManagement/ZoneManagement.js';
    import {
      ScoreboardComponent, initializeScoreboardListener
    } from './components/Scoreboard/Scoreboard.js';
    import {
      BroadcastComponent, initializeBroadcastLogic
    } from './components/Broadcast/Broadcast.js';
    import { TeamLinksComponent } from './components/TeamLinks/TeamLinks.js';
    import { listenToAllMessages } from './modules/chatManager.js';
    import { loadGoogleMapsApi } from './modules/googleMapsLoader.js';

    async function main() {
      document.getElementById('game-controls-container').innerHTML   = GameControlsComponent();
      document.getElementById('bugstrike-control-container').innerHTML = BugStrikeControlComponent();
      document.getElementById('speedbump-container').innerHTML = SpeedBumpControlComponent();
      document.getElementById('surprise-selector-container').innerHTML = SurpriseSelectorComponent();
      document.getElementById('scoreboard-container').innerHTML      = ScoreboardComponent();
      document.getElementById('team-links-container').innerHTML      = TeamLinksComponent();
      document.getElementById('racer-management-container').innerHTML= RacerManagementComponent();
      document.getElementById('zone-management-container').innerHTML = ZoneManagementComponent();
      document.getElementById('broadcast-container').innerHTML       = BroadcastComponent();

      initializeScoreboardListener();
      initializeGameControlsLogic();
      initializeBugStrikeControl();
      initializeSpeedBumpControl();
      initializeSurpriseSelector();
      initializeRacerManagementLogic();
      initializeBroadcastLogic();
      listenToAllMessages();

      try {
        await loadGoogleMapsApi();
        initializeZoneManagementLogic(true);
      } catch (err) {
        console.error('‚ùå Failed to load Maps:', err);
      }
    }

    document.addEventListener('DOMContentLoaded', main);
  </script>
  -->
  <script type="module" src="/ui/notifications/notifications.subscribe.js"></script>
  <script type="module" src="/ui/notifications/chat.subscribe.js"></script>
  <script type="module" src="/ui/notifications/flatTire.subscribe.js"></script>
  <script type="module" src="/ui/notifications/playerPage.subscribe.js"></script>
  <script type="module" src="/ui/overlays/speedbump.subscribe.js"></script>
  <script type="module" src="/ui/overlays/teamSurprise.subscribe.js"></script>
</body>
</html>
