<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Route Riot ‚Äì Control</title>
  <link rel="stylesheet" href="/style.css" />

  <!-- Favicons -->
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/site.webmanifest" />
</head>
<body>
  <div class="container">
    <!-- GAME CONTROLS RENDERED DYNAMICALLY -->
    <div id="game-controls-container"></div>

    <!-- BUG STRIKE CONTROL PANEL ü™∞ -->
    <div id="bugstrike-control-container"></div>

    <!-- OTHER COMPONENT SECTIONS -->
    <div id="scoreboard-container"></div>
    <div id="team-links-container"></div>
    <div id="racer-management-container"></div>
    <div id="zone-management-container"></div>
    <div id="game-challenges-container"></div>
    <div id="broadcast-container"></div>

    <!-- Optional Manual Control Buttons -->
    <div class="manual-controls" style="text-align:center; margin-top:20px;">
      <button id="pause-btn">‚è∏Ô∏è Pause Game</button>
      <button id="resume-btn">‚ñ∂Ô∏è Resume Game</button>
    </div>
  </div>

  <!-- Modal for Team URL Distribution -->
  <div id="roster-modal" class="modal-backdrop" style="display: none;">
    <div class="modal-content">
      <span class="modal-close-btn">&times;</span>
      <h2>Team Rosters &amp; Links</h2>
      <p>Email the unique player URL to each team captain.</p>
      <div id="roster-modal-body"></div>
    </div>
  </div>

  <!-- Main Control Script (inline orchestrator, matches your original flow) -->
  <script type="module">
    import {
      GameControlsComponent,
      initializeGameControlsLogic
    } from './components/GameControls/GameControls.js';

    import {
      BugStrikeControlComponent,
      initializeBugStrikeControl
    } from './components/BugStrikeControl/BugStrikeControl.js';

    import {
      RacerManagementComponent,
      initializeRacerManagementLogic
    } from './components/RacerManagement/RacerManagement.js';

    import {
      ZoneManagementComponent,
      initializeZoneManagementLogic
    } from './components/ZoneManagement/ZoneManagement.js';

    import {
      ScoreboardComponent,
      initializeScoreboardListener
    } from './components/Scoreboard/Scoreboard.js';

    import {
      GameChallengesComponent,
      initializeGameChallengesLogic
    } from './components/GameChallenges/GameChallenges.js';

    import { BroadcastComponent, initializeBroadcastLogic } from './components/Broadcast/Broadcast.js';
    import { TeamLinksComponent } from './components/TeamLinks/TeamLinks.js';

    import { listenToAllMessages } from './modules/chatManager.js';
    import { loadGoogleMapsApi } from './modules/googleMapsLoader.js';

    async function main() {
      // 1Ô∏è‚É£ Render components (DOM containers already exist above)
      document.getElementById('game-controls-container').innerHTML   = GameControlsComponent();
      document.getElementById('bugstrike-control-container').innerHTML = BugStrikeControlComponent();
      document.getElementById('scoreboard-container').innerHTML      = ScoreboardComponent({ editable: true });
      document.getElementById('team-links-container').innerHTML      = TeamLinksComponent();
      document.getElementById('racer-management-container').innerHTML= RacerManagementComponent();
      document.getElementById('zone-management-container').innerHTML = ZoneManagementComponent();
      document.getElementById('game-challenges-container').innerHTML = GameChallengesComponent();
      document.getElementById('broadcast-container').innerHTML       = BroadcastComponent();

      // 2Ô∏è‚É£ Initialize logic
      initializeScoreboardListener({ editable: true });
      initializeGameControlsLogic();
      initializeBugStrikeControl();        // ü™∞ wire up Bug Strike control panel
      initializeRacerManagementLogic();
      initializeGameChallengesLogic();
      initializeBroadcastLogic();
      listenToAllMessages();

      // 3Ô∏è‚É£ Load Google Maps & Zones
      try {
        await loadGoogleMapsApi();
        initializeZoneManagementLogic(true);
      } catch (err) {
        console.error('‚ùå Failed to load Google Maps API', err);
      }
    }

    document.addEventListener('DOMContentLoaded', main);
  </script>
</body>
</html>